<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Windows &#183; 白汤四物</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/regular.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href rel=alternate type=application/rss+xml title=白汤四物><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-3GNL63B62Q"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3GNL63B62Q")</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/search/><span>搜索</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><div class=banner><main><ul class=breadcrumb><li><a href=../>标签</a></li><li class=active>Windows</li></ul></main></div><main class=taxon><div class="catalogue taxonomy"><div class=catalogue-item><time datetime="2025-09-19 00:00:00 +0000 UTC" class=catalogue-time>2025年9月19日</time>
<a href=/posts/window-to-tray-minimization-tool-upgraded-from-traymond-to-traynard/ class=catalogue-title>窗口托盘最小化工具从 Traymond 进化为 Traynard</a><div class=catalogue-line></div><div class=catalogue-summary><p>在前文《<a href=/posts/traymond-minimize-any-window-to-the-system-tray/>增强版 Traymond 让任意窗口最小化到系统托盘</a>》中介绍了一款可以将任意窗口最小化到系统托盘的 Windows 桌面小工具。该工具代码 fork 自另一个同名项目，新增了一些功能并做了界面中文化。不过原项目是基于 Windows API 开发的，没有使用任何 GUI 框架，想要在此之上做进一步扩展非常麻烦，索性推倒重来。</p><a href=https://github.com/tabris17/traynard target=_blank class=card title=https://github.com/tabris17/traynard><div class=card-image style=background-image:url(/posts/window-to-tray-minimization-tool-upgraded-from-traymond-to-traynard/logo.png)></div><div class=card-content><strong class=card-content-title>tabris17/traynard</strong><span class=card-content-subtitle>github.com</span><span class=card-content-desc>a Windows desktop utility for minimizing any application window to the system tray</span></div></a><h2 id=功能介绍>功能介绍</h2><p>新版本除了保留原来的 icon 外，已全部使用 <a href=/tags/Lazarus/>Lazarus</a> 重写，并在原有功能的基础上，新增了<strong>图标分组</strong>和<strong>扩展窗口菜单</strong>的功能。</p><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2025-09-09 00:00:00 +0000 UTC" class=catalogue-time>2025年9月9日</time>
<a href=/posts/what-is-the-windows-userchoice-protection-driver-ucpd.sys/ class=catalogue-title>什么是 Windows UserChoice 保护驱动（UCPD.sys）</a><div class=catalogue-line></div><div class=catalogue-summary><p>在社交媒体上刷到一条非常扯淡的帖子，算是典型的蛆头为了吃「爱国」流量饭，利用民粹主义，专门针对低认知的蠢货们打造的无耻谣言。冠之以「技术流分析」，实则狗屁不懂。</p><figure><img src=/posts/what-is-the-windows-userchoice-protection-driver-ucpd.sys/xhs.png alt=xhs></figure><p>言归正传，这个 <samp>UCPD.sys</samp> 究竟是什么来头呢？故事还要从当年流氓软件大战说起……</p><p>早期 Windows 对文件关联（即文件默认打开程序）的管理非常简单——任何程序都可以通过修改注册表键值来修改文件关联。这导致各种流氓软件滥用该特性来霸占用户电脑，特别是国产浏览器，通过修改 http/https 协议关联程序，来劫持用户上网行为。</p><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2025-03-21 00:00:00 +0000 UTC" class=catalogue-time>2025年3月21日</time>
<a href=/posts/record-a-winget-upgrade-troubleshooting/ class=catalogue-title>记一次 WinGet 升级故障排查</a><div class=catalogue-line></div><div class=catalogue-summary><p>本文记录一次 WinGet 升级故障排查的过程。最终删除了 Windows 应用商店安装的版本，再使用 Scoop 重新安装，通过这种方式解决了问题。</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2025-01-15 00:00:00 +0000 UTC" class=catalogue-time>2025年1月15日</time>
<a href=/posts/windows-shim-cache-leaks-programs-previously-executed/ class=catalogue-title>泄露程序执行记录的 Windows Shim 缓存</a><div class=catalogue-line></div><div class=catalogue-summary><p>Windows Shim 是一种让新操作系统能兼容旧程序的技术。顾名思义，Shim 会在应用程序和操作系统之间增加一层处理逻辑，比如拦截和修改 API 调用的参数和返回值，模拟旧的操作系统，实现兼容应用程序的目的。</p><p>由于并非所有的程序都需要进行兼容处理，Windows 为此提供了一个名为 <a href=https://learn.microsoft.com/en-us/windows/win32/devnotes/application-compatibility-database target=_blank rel=noopener>Application Compatibility Database</a> （应用程序兼容性数据库）的数据库，通常简写为 <abbr title="Shim Database">SDB</abbr>，其中保存了需要兼容的程序清单，以及需要进行的兼容性操作。然而，每次创建进程都要查询数据库会损耗性能，Windows 将查询结果缓存在内存中。该缓存被称作 <samp>Application Compatibility Cache</samp>，大小为 1024 条，并且在每次系统关机时写入注册表作为持久化保存。正是由于这个特性，导致泄露了用户程序执行记录。</p><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2025-01-13 00:00:00 +0000 UTC" class=catalogue-time>2025年1月13日</time>
<a href=/posts/shellbags-leaks-windows-explorer-browsing-history/ class=catalogue-title>泄露 Windows 资源管理器浏览记录的 Shell Bags</a><div class=catalogue-line></div><div class=catalogue-summary><p>Windows 资源管理器会记住用户访问过的每个文件夹的视图细节，包括窗口大小、视图模式、排序方式、图标大小、分组依据等。这个特性有点类似 macOS 系统里的 .DS_store 文件夹。这些文件夹的视图信息会被保存在注册表中，我们根据微软对这组注册表项的命名，将该特性称作 <strong>Shell Bags</strong>。一些 Windows 取证工具利用该特性，可以提取出用户的访问历史，包括已删除的文件夹、网络文件夹和可移动存储设备文件夹。</p><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2024-12-12 00:00:00 +0000 UTC" class=catalogue-time>2024年12月12日</time>
<a href=/posts/Zone.Identifier-files-and-NTFS-alternate-data-streams/ class=catalogue-title>Zone.Identifier 文件和 NTFS 数据流</a><div class=catalogue-line></div><div class=catalogue-summary><p>使用 Windows 资源管理器，将 Windows 中的文件复制到 WSL 文件系统中时发现，目标路径下会多出一个 <samp>Zone.Identifier</samp> 后缀的文件：</p><pre><code class=language-text>foo.txt
foo.txt:Zone.Identifier</code></pre><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2024-11-27 00:00:00 +0000 UTC" class=catalogue-time>2024年11月27日</time>
<a href=/posts/How-to-determine-if-a-window-handle-is-the-top-level-window-on-the-desktop/ class=catalogue-title>如何判断一个窗口句柄是否为桌面顶层窗口</a><div class=catalogue-line></div><div class=catalogue-summary><p>在微软官方文档中，并没有提供一个 API 用于判断一个窗口句柄是否为桌面的顶层窗口。通过类似 <code>NULL == GetParent(hwnd)</code> 或者 <code>hwnd == GetAncestor(hWnd,GA_ROOT)</code> 等简单代码都无法做出正确判断。经过测试，找到两种靠谱的解决方案。</p><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2024-11-15 00:00:00 +0000 UTC" class=catalogue-time>2024年11月15日</time>
<a href=/posts/change-the-width-of-menus-via-windows-api/ class=catalogue-title>Windows API 编程之调整菜单宽度</a><div class=catalogue-line></div><div class=catalogue-summary><p>好多年没碰 Windows API 编程了，这次写 <a href=https://github.com/tabris17/traymond target=_blank rel=noopener>Traymond</a> 才发现：堂堂 Windows 竟然没有一个 API 能够用来调整菜单的宽度。</p><p>通常，在程序中使用的静态菜单都是直接从资源中载入的，而这次需要动态增删菜单项目。这时我才发现一个问题：当用 <code>InsertMenuItem()</code> 函数插入一个菜单项时，Windows 会根据菜单项文本自动增加菜单宽度；但是当使用 <code>DeleteMenu()</code> 函数删除菜单项后，Windows 却无法根据剩余的菜单项文本自动缩小菜单宽度。搜遍全网，也只找到两种解决方法。</p><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2024-11-14 00:00:00 +0000 UTC" class=catalogue-time>2024年11月14日</time>
<a href=/posts/convert-an-icon-to-a-bitmap-via-windows-api/ class=catalogue-title>使用 Windows API 将图标转换成位图</a><div class=catalogue-line></div><div class=catalogue-summary><p>在不依赖任何第三方库、仅使用 Windows API 的前提下，需要将窗口图标（HICON）转换成作为菜单图标的位图（HBITMAP）。</p><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div><div class=catalogue-item><time datetime="2024-11-08 00:00:00 +0000 UTC" class=catalogue-time>2024年11月8日</time>
<a href=/posts/traymond-minimize-any-window-to-the-system-tray/ class=catalogue-title>增强版 Traymond 让任意窗口最小化到系统托盘</a><div class=catalogue-line></div><div class=catalogue-summary><div class=note><div class=note-content><p>本项目已更名为 <a href=https://github.com/tabris17/traynard target=_blank rel=noopener>Traynard</a>，并使用 Lazarus 完全重构。新版本提供更多的功能和更加易用的操作界面。原增强版 Traymond 仅保留下载，不再更新。</p><p>详见：<a href=/posts/window-to-tray-minimization-tool-upgraded-from-traymond-to-traynard/>窗口托盘最小化工具从 Traymond 进化为 Traynard</a></p></div><div class=note-footer>增订于<time>2025年9月19日</time></div></div><p><a href=https://github.com/fcFn/traymond target=_blank rel=noopener>Traymond</a> 是一款 Windows 上的小工具，可以将任意窗口最小化为系统托盘图标，双击图标即可还原窗口。软件启动后会在后台运行，按下热键 <kbd>Win</kbd> + <kbd>Shift</kbd> + <kbd>Z</kbd> 后，当前窗口会最小化到系统托盘图标，双击图标可以恢复窗口。软件正常退出时会自动恢复期间最小化的窗口。另外，如果程序意外终止，重新启动程序，最小化窗口的都会恢复。</p><p>&mldr;&mldr;</p></div><ul class=catalogue-tags><li>#<a href=/tags/Windows/>Windows</a></li></ul></div></div><div class=pagination><a class=left>&nbsp</a>
<a href=/tags/Windows/page/2/ class="right arrow">下一页</a>
<span><sup>1</sup> &frasl; <sub>3</sub></span></div></main><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/delphi.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/dos.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/haxe.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-svelte/dist/svelte.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-zig/dist/zig.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-redbol/dist/redbol.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=/js/code.js></script><script>hljs.highlightAll(),hljs.initLineNumbersOnLoad(),hljs.initSelectLines()</script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js crossorigin=anonymous referrerpolicy=no-referrer onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})</script><footer><span>&copy; <time datetime="2025-10-13 05:00:59.374035399 +0000 UTC m=+1.372675371">2025</time> fournoas.com. Powered by <a href=https://gohugo.io/>Hugo</a> v0.151.0.</span></footer></body></html>