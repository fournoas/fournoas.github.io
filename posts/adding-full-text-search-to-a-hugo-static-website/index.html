<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>为 Hugo 静态网站添加全文检索功能 &#183; 白汤四物</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/fontawesome.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/solid.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=/js/code.js></script>
<script>hljs.highlightAll(),hljs.initLineNumbersOnLoad(),hljs.initSelectLines()</script><link href rel=alternate type=application/rss+xml title=白汤四物><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-153840298-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-153840298-1")</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/search/><span>搜索</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><main data-pagefind-body><div class=post><h1 class=post-title data-pagefind-meta=title>为 Hugo 静态网站添加全文检索功能</h1><div class=post-line></div><div class=post-info><span>作者</span>
<span data-pagefind-meta=作者>Fournoas</span>
<span>于&nbsp;</span><time datetime="2022-10-18 00:00:00 +0000 UTC" data-pagefind-meta=日期>2022年10月18日</time>
<span>发布在&nbsp;</span><ul class=categories><li><a data-pagefind-filter=分类 href=https://www.fournoas.com/categories/using/>Using</a></li></ul></div><p><a href=https://gohugo.io/>Hugo</a> 是一种使用 Go 语言编写的静态网站构建工具。在其官网文章《<a href=https://gohugo.io/tools/search/>Search for your Hugo Website</a>》中，介绍几种为静态网站添加全文检索功能的方法。本文采用 <a href=https://pagefind.app/>Pagefind</a> 为纯静态网站实现全文检索功能。</p><p>Pagefind 是一个独立的命令行工具，可以通过 <code>npm install pagefind</code> 来安装。其原理是：运行 Pagefind 命令，扫描所有静态网页并生成索引；用户搜索时，通过网页中内嵌的 JavaScript 脚本来访问预先生成的索引，从而实现静态全文检索。</p><blockquote><p>Windows 系统下，使用 <code>npm i pagefind</code> 安装后，需要将 <code>node_modules\pagefind\bin\pagefind_extended</code> 文件重命名为 <code>pagefind_extended.exe</code> 才能正常使用。</p></blockquote><h2 id=实现原理>实现原理</h2><p><strong>第一步</strong>，安装 Pagefind 工具。在 Hugo 项目根目录中运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm i pagefind
</span></span></code></pre></div><p><strong>第二步</strong>，生成 Hugo 网站的静态文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hugo --minify
</span></span></code></pre></div><p><strong>第三步</strong>，生成 Pagefind 索引：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npx pagefind --source public --bundle-dir search
</span></span></code></pre></div><p>此命令会扫描 public 目录下的静态文件，并将生成的索引保存到 search 目录下（默认是 _pagefind 目录）。也可以通过配置文件来实现相同的操作。</p><p>在项目根目录下新建 <code>pagefind.yml</code> 配置文件，保存如下内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>source</span>: <span style=color:#ae81ff>public</span>
</span></span><span style=display:flex><span><span style=color:#f92672>bundle_dir</span>: <span style=color:#ae81ff>search</span>
</span></span></code></pre></div><p>然后直接运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npx pagefind
</span></span></code></pre></div><p>Pagefind 会自动在当前目录下查找 <code>pagefind.yml</code> 配置文件，使用参数或配置文件的效果是等价的。其他参数可以参考<a href=https://pagefind.app/docs/config-options/>官方文档</a>。</p><p><strong>第四步</strong>，在静态网页中添加全文搜索的入口：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/search/pagefind-ui.css&#34;</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/search/pagefind-ui.js&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;search&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>    window.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;DOMContentLoaded&#39;</span>, (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PagefindUI</span>({ <span style=color:#a6e22e>element</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;#search&#34;</span> });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><h2 id=自定义索引>自定义索引</h2><p>可以通过在静态网页中添加特殊的 HTML 属性来控制 Pagefind 的行为。比如，HTML 元素添加属性 <code>data-pagefind-body</code> 表示需要索引此处的内容，添加属性 <code>data-pagefind-ignore</code> 表示不要索引此处内容。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>article</span> <span style=color:#a6e22e>data-pagefind-body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>h1</span> <span style=color:#a6e22e>data-pagefind-meta</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;title&#34;</span>&gt;文章标题&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>p</span>&gt;发布时间：&lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>data-pagefind-meta</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;日期&#34;</span>&gt;2022/10/18&lt;/<span style=color:#f92672>span</span>&gt;&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>p</span>&gt;作者：&lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>data-pagefind-meta</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;作者&#34;</span>&gt;Fournoas&lt;/<span style=color:#f92672>span</span>&gt;&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>p</span>&gt;正文内容&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>aside</span> <span style=color:#a6e22e>data-pagefind-ignore</span>&gt;目录&lt;/<span style=color:#f92672>aside</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>article</span>&gt;
</span></span></code></pre></div><p><code>data-pagefind-meta</code> 属性用于标记元数据。Pagefind 默认将网页中的 <code>&lt;h1></code> 元素中的文本当作标题。如果一个网页中包含多个 <code>&lt;h1></code> 标签，会导致搜索结果中的标题丢失。可以采取为元素添加属性 <code>data-pagefind-meta="title"</code> 指定网页的标题。</p><p>此外，还能通过 <code>data-pagefind-filter</code> 属性自定义搜索过滤器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>h1</span>&gt;文章标题&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>p</span>&gt;分类: &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>data-pagefind-filter</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;分类&#34;</span>&gt;小说&lt;/<span style=color:#f92672>span</span>&gt;&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>p</span>&gt;标签: &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>data-pagefind-filter</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;标签&#34;</span>&gt;科幻&lt;/<span style=color:#f92672>span</span>&gt; / &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>data-pagefind-filter</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;标签&#34;</span>&gt;穿越&lt;/<span style=color:#f92672>span</span>&gt;&lt;/<span style=color:#f92672>p</span>&gt;
</span></span></code></pre></div><p>上面的代码会让搜索结果的左侧会出现 <code>分类</code> 和 <code>标签</code> 两个过滤器。</p><h2 id=配置-github-actions>配置 GitHub Actions</h2><p>在文章《<a href=/posts/deploy-hugo-site-using-github-actions/>使用 GitHub Actions 自动部署 Hugo 站点</a>》中提供了自动部署 Hugo 站点的 Workflow 配置，在此基础上进行简单修改，即可实现自动生成索引并发布。</p><p>编辑 <code>.github/workflows/hugo.yml</code> 文件，在 <code>steps</code> 小结中的 <code>Build</code> 和 <code>Deploy</code> 操作之间添加如下内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install nodejs</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/setup-node@v3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>node-version</span>: <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm i pagefind</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npx pagefind --source public --bundle-dir search</span>
</span></span></code></pre></div><p>最后实现效果可以查看本站的<a href=/search/>搜索</a>页面。</p><script src=/js/post.js></script></div><div class=taxonomy data-pagefind-ignore><div class=taxonomy-tags><ul class=tags><li>#<a data-pagefind-filter=标签 href=https://www.fournoas.com/tags/Hugo/>Hugo</a></li></ul></div></div><div class=pagination data-pagefind-ignore><a href=/posts/hide-mastodon-site-information-and-user-toots-list/ class="left arrow">上一篇：<br>隐藏 Mastodon 站点信息和用户嘟文列表</a>
<a href=/posts/monte-carlo-simulation-of-a-middle-school-math-olympiad-problem/ class="right arrow">下一篇：<br>一道初中奥数题的蒙特卡洛解法</a>
<a href=# class=top>返回顶部</a></div></main><footer><span>&copy; <time datetime="2022-11-04 02:22:29.289203314 +0000 UTC m=+0.383997569">2022</time> fournoas.com. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://pagefind.app>Pagefind</a>, theme by <a href=https://github.com/EmielH/tale-hugo>Tale</a>.</span></footer><script src=/js/main.js></script></body></html>