<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Hugo 是一种使用 Go 语言编写的静态网站构建工具。在其官网文章《Search for your Hugo Website》中，介绍几种为静态网站添加全文检索功能的方法。本文采用 Pagefind 为纯静态网站实现全文检索功能。 Pagefind 是一个独立的命令行工具，可以通过 npm install pagefind 来安装。其原理是：运行 Pagefind 命令，扫描所有静态网页并生成索引；用户搜"><title>为 Hugo 静态网站添加全文检索功能 &#183; 白汤四物</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/regular.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href rel=alternate type=application/rss+xml title=白汤四物><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-3GNL63B62Q"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3GNL63B62Q")</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/search/><span>搜索</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><main data-pagefind-body><div class="page post"><h1 class=post-title data-pagefind-meta=title>为 Hugo 静态网站添加全文检索功能</h1><div class=post-line></div><div class=post-info><span>作者</span>
<span data-pagefind-meta=作者>Fournoas
</span><span>于&nbsp;</span><time datetime="2022-10-18 00:00:00 +0000 UTC" data-pagefind-meta=日期>2022年10月18日</time>
<span>发布在&nbsp;</span><ul class=categories><li><a data-pagefind-filter=分类 href=/categories/using/>Using</a></li></ul></div><p><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 是一种使用 Go 语言编写的静态网站构建工具。在其官网文章《<a href=https://gohugo.io/tools/search/ target=_blank rel=noopener>Search for your Hugo Website</a>》中，介绍几种为静态网站添加全文检索功能的方法。本文采用 <a href=https://pagefind.app/ target=_blank rel=noopener>Pagefind</a> 为纯静态网站实现全文检索功能。</p><p>Pagefind 是一个独立的命令行工具，可以通过 <code>npm install pagefind</code> 来安装。其原理是：运行 Pagefind 命令，扫描所有静态网页并生成索引；用户搜索时，通过网页中内嵌的 JavaScript 脚本来访问预先生成的索引，从而实现静态全文检索。</p><blockquote><p>Windows 系统下，使用 <code>npm i pagefind</code> 安装后，需要将 <code>node_modules\pagefind\bin\pagefind_extended</code> 文件重命名为 <code>pagefind_extended.exe</code> 才能正常使用。</p></blockquote><h2 id=实现原理>实现原理</h2><p><strong>第一步</strong>，安装 Pagefind 工具。在 Hugo 项目根目录中运行：</p><pre><span class=code-lang>BASH</span><code class=language-bash>npm i pagefind</code></pre><p><strong>第二步</strong>，生成 Hugo 网站的静态文件：</p><pre><span class=code-lang>BASH</span><code class=language-bash>hugo --minify</code></pre><p><strong>第三步</strong>，生成 Pagefind 索引：</p><pre><span class=code-lang>BASH</span><code class=language-bash>npx pagefind --source public --bundle-dir search</code></pre><p>此命令会扫描 public 目录下的静态文件，并将生成的索引保存到 search 目录下（默认是 _pagefind 目录）。也可以通过配置文件来实现相同的操作。</p><p>在项目根目录下新建 <code>pagefind.yml</code> 配置文件，保存如下内容：</p><pre><span class=code-lang>YAML</span><code class=language-yaml>source: public
bundle_dir: search</code></pre><p>然后直接运行：</p><pre><span class=code-lang>BASH</span><code class=language-bash>npx pagefind</code></pre><p>Pagefind 会自动在当前目录下查找 <code>pagefind.yml</code> 配置文件，使用参数或配置文件的效果是等价的。其他参数可以参考<a href=https://pagefind.app/docs/config-options/ target=_blank rel=noopener>官方文档</a>。</p><p><strong>第四步</strong>，在静态网页中添加全文搜索的入口：</p><pre><span class=code-lang>HTML</span><code class=language-html>&lt;link href=&#34;/search/pagefind-ui.css&#34; rel=&#34;stylesheet&#34;&gt;
&lt;script src=&#34;/search/pagefind-ui.js&#34; type=&#34;text/javascript&#34;&gt;&lt;/script&gt;

&lt;div id=&#34;search&#34;&gt;&lt;/div&gt;
&lt;script&gt;
    window.addEventListener(&#39;DOMContentLoaded&#39;, (event) =&gt; {
        new PagefindUI({ element: &#34;#search&#34; });
    });
&lt;/script&gt;</code></pre><h2 id=自定义索引>自定义索引</h2><p>可以通过在静态网页中添加特殊的 HTML 属性来控制 Pagefind 的行为。比如，HTML 元素添加属性 <code>data-pagefind-body</code> 表示需要索引此处的内容，添加属性 <code>data-pagefind-ignore</code> 表示不要索引此处内容。</p><pre><span class=code-lang>HTML</span><code class=language-html>&lt;article data-pagefind-body&gt;
    &lt;h1 data-pagefind-meta=&#34;title&#34;&gt;文章标题&lt;/h1&gt;
    &lt;p&gt;发布时间：&lt;span data-pagefind-meta=&#34;日期&#34;&gt;2022/10/18&lt;/span&gt;&lt;/p&gt;
    &lt;p&gt;作者：&lt;span data-pagefind-meta=&#34;作者&#34;&gt;Fournoas&lt;/span&gt;&lt;/p&gt;
    &lt;p&gt;正文内容&lt;/p&gt;
    &lt;aside data-pagefind-ignore&gt;目录&lt;/aside&gt;
&lt;/article&gt;</code></pre><p><code>data-pagefind-meta</code> 属性用于标记元数据。Pagefind 默认将网页中的 <code>&lt;h1></code> 元素中的文本当作标题。如果一个网页中包含多个 <code>&lt;h1></code> 标签，会导致搜索结果中的标题丢失。可以采取为元素添加属性 <code>data-pagefind-meta="title"</code> 指定网页的标题。</p><p>此外，还能通过 <code>data-pagefind-filter</code> 属性自定义搜索过滤器：</p><pre><span class=code-lang>HTML</span><code class=language-html>&lt;h1&gt;文章标题&lt;/h1&gt;
&lt;p&gt;分类: &lt;span data-pagefind-filter=&#34;分类&#34;&gt;小说&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;标签: &lt;a data-pagefind-filter=&#34;标签&#34;&gt;科幻&lt;/span&gt; / &lt;a data-pagefind-filter=&#34;标签&#34;&gt;穿越&lt;/span&gt;&lt;/p&gt;</code></pre><p>上面的代码会让搜索结果的左侧会出现 <code>分类</code> 和 <code>标签</code> 两个过滤器。</p><h2 id=配置-github-actions>配置 GitHub Actions</h2><p>在文章《<a href=/posts/deploy-hugo-site-using-github-actions/>使用 GitHub Actions 自动部署 Hugo 站点</a>》中提供了自动部署 Hugo 站点的 Workflow 配置，在此基础上进行简单修改，即可实现自动生成索引并发布。</p><p>编辑 <code>.github/workflows/hugo.yml</code> 文件，在 <code>steps</code> 小结中的 <code>Build</code> 和 <code>Deploy</code> 操作之间添加如下内容：</p><pre><span class=code-lang>YML</span><code class=language-yml>  - name: Install nodejs
    uses: actions/setup-node@v3
    with:
      node-version: 18
  - run: npm i pagefind
  - run: npx pagefind --source public --bundle-dir search</code></pre><p>最后实现效果可以查看本站的<a href=/search/>搜索</a>页面。</p></div><div class=taxonomy data-pagefind-ignore><div class=taxonomy-tags><ul class=tags><li>#<a data-pagefind-filter=标签 href=/tags/Hugo/>Hugo</a></li></ul></div></div><div class=pagination data-pagefind-ignore><a href=/posts/monte-carlo-simulation-of-a-middle-school-math-olympiad-problem/ class="left arrow">上一篇：<br>一道初中奥数题的蒙特卡洛解法</a>
<a href=/posts/hide-mastodon-site-information-and-user-toots-list/ class="right arrow">下一篇：<br>隐藏 Mastodon 站点信息和用户嘟文列表</a>
<a href=# class=top>返回顶部</a></div></main><script src=/js/page.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/delphi.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dos.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/haxe.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=/js/code.js></script><script>hljs.highlightAll(),hljs.initLineNumbersOnLoad(),hljs.initSelectLines()</script><footer><span>&copy; <time datetime="2024-06-28 06:16:14.03947969 +0000 UTC m=+0.903410573">2024</time> fournoas.com. Powered by <a href=https://gohugo.io>Hugo</a>.</span></footer></body></html>