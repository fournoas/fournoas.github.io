<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>搭建 iOS 平台的个人通知推送服务 &middot; 白汤四物</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/fontawesome.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/solid.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script>hljs.highlightAll();</script><script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title=白汤四物><script async src="https://www.googletagmanager.com/gtag/js?id=UA-153840298-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-153840298-1');</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><main><div class=post><h1 class=post-title>搭建 iOS 平台的个人通知推送服务</h1><div class=post-line></div><div class=post-info><span>作者</span>
Fournoas
<span>于&nbsp;</span><time datetime="2021-08-01 00:00:00 &#43;0000 UTC">2021年8月1日</time>
<span>发布在</span><ul class=categories><li><a href=https://www.fournoas.com/categories/using/>Using</a></li></ul></div><p><a href=https://github.com/Finb/Bark target=_blank>Bark</a> 是一款可以给 iOS 系统推送自定义通知的开源应用，用户可以通过 HTTP 接口向自己的手机或者 iOS 设备推送消息。应用内置了公共服务器，软件作者也提供了开源的<a href=https://github.com/Finb/bark-server target=_blank>服务端</a>用于搭建个人推送服务器。此外，还可以通过 <a href=https://chrome.google.com/webstore/detail/bark/pmlkbdbpglkgbgopghdcmohdcmladeii target=_blank>Chrome 浏览器扩展</a>来调用推送接口。</p><h1 id=部署服务端>部署服务端</h1><p>应用内置了公共服务器，如果你没有隐私方面的需求，可以直接使用公共服务器进行推送。但是为了稳定性和私密性，建议自己搭建服务器。</p><p>服务端使用 Go 语言编写，可以直接下载并运行编译好的二进制可执行文件，无需配置。此处以 CentOS 7 x86_64 系统为例讲解如何部署服务端。</p><h2 id=下载>下载</h2><p>从 GitHub 上下载对应平台的二进制可执行文件：<a href=https://github.com/Finb/bark-server/releases target=_blank>https://github.com/Finb/bark-server/releases</a> 。此处应选择 <a href=https://github.com/Finb/bark-server/releases/download/v2.0.2/bark-server_linux_amd64 target=_blank>bark-server_linux_amd64</a> 版本。</p><pre><code class=language-shell>wget https://github.com/Finb/bark-server/releases/download/v2.0.2/bark-server_linux_amd64
chmod +x bark-server_linux_amd64
mv ./bark-server_linux_amd64 /usr/local/bin/bark-server
</code></pre><blockquote><p>注意：本文例子中的命令皆在 root 权限下运行。部署时请自行解决权限问题。</p></blockquote><h2 id=安装服务>安装服务</h2><p>新建用于保存 Bark 数据的目录：</p><pre><code class=language-shell>mkdir /var/local/bark
chmod +w /var/local/bark
</code></pre><p>新建服务配置文件：</p><pre><code class=language-shell>nano /etc/systemd/system/bark.service
</code></pre><p>写入如下内容：</p><pre><code class=language-ini>[Unit]
Description=Bark Service
After=network.target
Wants=network.target

[Service]
Type=simple
PIDFile=/run/bark.pid
ExecStart=/usr/local/bin/bark-server -user admin -password 123456 -addr 127.0.0.1:8000 -data /var/local/bark
Restart=on-failure
RestartPreventExitStatus=23

[Install]
WantedBy=multi-user.target
</code></pre><p>本例中 Bark 服务器运行在 8000 端口，你也可以改成其他端口。<code>-user</code> 和 <code>-password</code> 参数用于设置 HTTP 接口的访问用户名和密码。如果设置了该组参数，除了 <code>/ping</code>、<code>/register</code>、<code>/healthz</code> 三个接口之外，都需要提供 HTTP Basic Auth 认证。此处用户名设为 <code>admin</code>，密码 <code>123456</code>，请自行修改。</p><p>执行命令载入配置并启动服务：</p><pre><code class=language-shell>systemctl daemon-reload
systemctl start bark
</code></pre><p>查看服务是否正确运行：</p><pre><code class=language-shell>netstat -anp|grep 8000
</code></pre><p>如果显示：</p><pre><code>tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      32459/bark-server
</code></pre><p>则表示服务成功运行。</p><h2 id=配置-nginx>配置 Nginx</h2><p>如果没有安装 nginx，请先安装：</p><pre><code class=language-shell>yum install -y nginx
</code></pre><p>新建配置文件：</p><pre><code class=language-shell>nano /etc/nginx/sites-available/bark.my.site
</code></pre><p>写入如下内容：</p><pre><code class=language-nginx>server {
    listen 80;
    listen [::]:80;
    server_name bark.my.site;

    location / {
        proxy_pass                         http://127.0.0.1:8000;
        proxy_read_timeout                 300;
        proxy_connect_timeout              300;
        proxy_redirect                     off;
        proxy_set_header Host              $host;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Real-IP         $remote_addr;
    }
}
</code></pre><p>其中 <code>bark.my.site</code> 是你的个人域名，你也可以直接使用 IP 地址。<code>http://127.0.0.1:8000</code> 是 Bark 运行服务的 URL。</p><p>使配置生效：</p><pre><code class=language-shell>ln -s /etc/nginx/sites-available/bark.my.site /etc/nginx/sites-enabled/bark.my.site
systemctl restart nginx
</code></pre><h1 id=安装手机应用>安装手机应用</h1><p>作者已经将编译好的手机应用发布到了 App Store。可以在 App Store 上搜索“Bark”进行安装，也可以通过下面的链接进行安装：</p><p><a href=https://apps.apple.com/cn/app/bark-customed-notifications/id1403753865 target=_blank>https://apps.apple.com/cn/app/bark-customed-notifications/id1403753865</a></p><p>安装完毕后打开 APP，点击应用右上角 <code>+</code> 按钮，输入之前配置的服务端地址：<code>http://bark.my.site</code>。</p><p>服务器配置完毕后，你可以在「服务器」页面看到形如 <code>http://bark.my.site/XXxxXXxxXXxxXX/这里改成你自己的推送内容</code> 的推送接口列表。其中 <code>XXxxXXxxXXxxXX</code> 就是你的设备代码。每次添加服务器，都会生成新的设备代码。</p><h1 id=调用接口>调用接口</h1><pre><code class=language-shell> curl --basic -u admin:123456 http://bark.my.site/{device_code}/测试消息
</code></pre><p>将命令中 <code>admin:123456</code> 改成之前设置的 <code>{用户名}:{密码}</code>，<code>{device_code}</code> 改成你的设备代码。测试成功的话，你的手机就能收到一条内容为「测试消息」的推送。</p><script src=/js/post.js></script></div><div class=taxonomy><div class=taxonomy-tags><ul class=tags><li>#<a href=https://www.fournoas.com/tags/%E7%AC%94%E8%AE%B0/>笔记</a></li></ul></div></div><div class=pagination><a href=/moments/202107/1627533473/ class="left arrow">上一篇</a>
<a href=/moments/202108/1627795668/ class="right arrow">下一篇</a>
<a href=# class=top>返回顶部</a></div></main><footer><span>&copy; <time datetime="2022-07-21 04:13:27.013723597 &#43;0000 UTC m=&#43;0.350247347">2022</time> fournoas.com. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/EmielH/tale-hugo>Tale</a> theme.</span></footer><script src=/js/main.js></script></body></html>