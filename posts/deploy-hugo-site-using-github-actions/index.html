<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="一直使用 Hugo 来生成静态网站，并通过 Travis CI 来自动化部署到 GitHub Pages。今天偶然得知 travis-ci.org 将于五月底关闭，正好趁此机会用 GitHub Actions 来替换 Travis CI。
创建代码仓库
首先按照文档创建 GitHub Pages 站点。该仓库可见性必须是 Public。
另外创建一个仓库用来存放 Hugo 的源文件，名称随意，这里假设仓库名叫 pages-hugo-source。建议将仓库可见性设置成 Private 以保护好你的源代码。"><title>使用 GitHub Actions 自动部署 Hugo 站点 &#183; 白汤四物</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/regular.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href rel=alternate type=application/rss+xml title=白汤四物><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-3GNL63B62Q"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3GNL63B62Q")</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/search/><span>搜索</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><main data-pagefind-body><div class="page post"><h1 class=post-title data-pagefind-meta=title>使用 GitHub Actions 自动部署 Hugo 站点</h1><div class=post-line></div><div class=post-info><span>作者</span>
<span data-pagefind-meta=作者>Fournoas
</span><span>于&nbsp;</span><time datetime="2021-05-25 00:00:00 +0000 UTC" data-pagefind-meta=日期>2021年5月25日</time>
<span>发布在&nbsp;</span><ul class=categories><li><a data-pagefind-filter=分类 href=/categories/using/>Using</a></li></ul></div><p>一直使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 来生成静态网站，并通过 <a href=https://travis-ci.org/ target=_blank rel=noopener>Travis CI</a> 来自动化部署到 <a href=https://docs.github.com/cn/pages target=_blank rel=noopener>GitHub Pages</a>。今天偶然得知 travis-ci.org 将于五月底关闭，正好趁此机会用 <a href=https://docs.github.com/cn/actions target=_blank rel=noopener>GitHub Actions</a> 来替换 Travis CI。</p><h2 id=创建代码仓库>创建代码仓库</h2><p>首先按照<a href=https://docs.github.com/cn/pages target=_blank rel=noopener>文档</a>创建 GitHub Pages 站点。该仓库可见性必须是 Public。</p><p>另外创建一个仓库用来存放 Hugo 的源文件，名称随意，这里假设仓库名叫 <code>pages-hugo-source</code>。建议将仓库可见性设置成 Private 以保护好你的源代码。</p><p>创建完毕后你的账户下将存在以下两个代码仓库：</p><ul><li>公有仓库：<pre><code class=language-text>https://github.com/&lt;YourName&gt;/&lt;YourName&gt;.github.io</code></pre></li><li>私有仓库：<pre><code class=language-text>https://github.com/&lt;YourName&gt;/pages-hugo-source</code></pre></li></ul><h2 id=创建-workflow-配置>创建 Workflow 配置</h2><p>在 <code>pages-hugo-source</code> 仓库下新建 <code>.github/workflows/hugo.yml</code> 文件。内容如下：</p><pre><span class=code-lang>YAML</span><code class=language-yaml>name: Generate Site
on:
  push:
    branches:
      - master
jobs:
  build-deploy:
    runs-on: ubuntu-18.04
    steps:
      - name: Check out source
        uses: actions/checkout@v2
        
      - name: Setup hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: &#34;latest&#34; # 可以修改为你使用的 Hugo 版本
          extended: true # 设置是否需要 extended 版本
          
      - name: Build
        run: hugo --minify
        
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          deploy_key: ${{ secrets.DEPLOY_TOKEN }} # 另外还支持 github_token 和 personal_token
          external_repository: &lt;YourName&gt;/&lt;YourName&gt;.github.io` # 修改为你的 GitHub Pages 仓库
          publish_dir: ./public
          keep_files: false
          publish_branch: master
          # 如果使用自定义域名，还需要添加下面一行配置
          # cname: www.fournoas.com</code></pre><p>该配置用到了两个第三方 Actions，分别是 <a href=https://github.com/marketplace/actions/hugo-setup target=_blank rel=noopener>Hugo setup</a> 和 <a href=https://github.com/marketplace/actions/github-pages-action target=_blank rel=noopener>GitHub Pages action</a>。前者用于安装 Hugo，后者用于部署静态站点。</p><h2 id=设置-ssh-key>设置 SSH Key</h2><p>GitHub Pages action 支持三种身份验证方式：</p><ul><li>deploy_key</li><li><a href=https://docs.github.com/cn/actions/reference/authentication-in-a-workflow target=_blank rel=noopener>github_token</a></li><li><a href=https://github.com/settings/tokens target=_blank rel=noopener>personal_token</a></li></ul><p>此处使用 deploy_key 方式。</p><p>执行命令创建 SSH Key：</p><pre><span class=code-lang>SHELL</span><code class=language-shell>ssh-keygen -t rsa -b 4096 -C &#34;$(git config user.email)&#34; -f gh-pages -N &#34;&#34;
# You will get 2 files:
#   gh-pages.pub (public key)
#   gh-pages     (private key)</code></pre><p>如果在 Windows 系统下运行该命令，要将命令中的 <code>$(git config user.email)</code> 替换成你的邮箱地址。</p><p>访问如下地址设置 Public key：</p><pre><code class=language-text>https://github.com/&lt;YourName&gt;/&lt;YourName&gt;.github.io/settings/keys/new</code></pre><p>表单中的 <code>Title</code> 随意填写，将刚才生成的 <code>gh-pages.pub</code> 文件内容填入 <code>Key</code> 中，勾选 <code>Allow write access</code>，点击 <code>Add key</code> 按钮保存。</p><p>访问如下地址设置 Private key：</p><pre><code class=language-text>https://github.com/&lt;YourName&gt;/pages-hugo-source/settings/secrets/actions/new</code></pre><p>表单中的 <code>Name</code> 填入 <code>DEPLOY_TOKEN</code>，将刚才生成的 <code>gh-pages</code> 文件内容填入 <code>Value</code> 中，点击 <code>Add secret</code> 按钮保存。</p><h2 id=执行-github-actions>执行 GitHub Actions</h2><p>将 <code>pages-hugo-source</code> 仓库的代码提交并推送到 GitHub，会自动触发 GitHub Actions 执行。可以访问如下网址来查看 Workflows 是否执行成功：</p><pre><code class=language-text>https://github.com/&lt;YourName&gt;/pages-hugo-source/actions</code></pre><p>等待 workflow 执行完毕，静态站点就算是发布成功了。</p></div><div class=taxonomy data-pagefind-ignore><div class=taxonomy-tags><ul class=tags><li>#<a data-pagefind-filter=标签 href=/tags/Hugo/>Hugo</a></li></ul></div></div><div class=pagination data-pagefind-ignore><a href=/posts/a-documentary-filmed-by-Americans-in-Shanghai-in-1973/ class="left arrow">上一篇：<br>一部1973年美国人在上海拍摄的纪录片</a>
<a href=/moments/202105/1621833154/ class="right arrow">下一篇</a>
<a href=# class=top>返回顶部</a></div></main><script src=/js/page.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/delphi.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/dos.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/haxe.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-svelte/dist/svelte.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=/js/code.js></script><script>hljs.highlightAll(),hljs.initLineNumbersOnLoad(),hljs.initSelectLines()</script><footer><span>&copy; <time datetime="2024-10-28 02:31:07.870364571 +0000 UTC m=+0.968877663">2024</time> fournoas.com. Powered by <a href=https://gohugo.io>Hugo</a>.</span></footer></body></html>