<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Free Pascal 支持交叉编译，理论上是可以在 Windows 平台上编译 Linux 可执行文件的，但是官方没有提供相关文档，且不建议这么做。除了使用虚拟机外，在 Windows 平台上还可以使用 WSL 来交叉编译 Lazarus 项目。"><title>在 WSL 中运行 Lazarus IDE &#183; 白汤四物</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/regular.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href rel=alternate type=application/rss+xml title=白汤四物><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-3GNL63B62Q"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3GNL63B62Q")</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/search/><span>搜索</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><main data-pagefind-body><div class="page post"><h1 class=post-title data-pagefind-meta=title>在 WSL 中运行 Lazarus IDE</h1><div class=post-line></div><div class=post-info><span>作者</span>
<span data-pagefind-meta=作者>Fournoas
</span><span>写于&nbsp;</span><time datetime="2024-01-19 00:00:00 +0000 UTC" data-pagefind-meta=日期>2024年1月19日</time>
<span>发布在&nbsp;</span><ul class=categories><li><a data-pagefind-filter=分类 href=/categories/coding/>Coding</a></li></ul></div><p>Free Pascal 支持交叉编译，理论上是可以在 Windows 平台上编译 Linux 可执行文件的，但是官方没有提供相关文档，且不建议这么做。除了使用虚拟机外，在 Windows 平台上还可以使用 WSL 来交叉编译 Lazarus 项目。</p><h2 id=安装-ide-和-free-pascal-编译器>安装 IDE 和 Free Pascal 编译器</h2><p>本人 WSL 安装的是 Ubuntu 系统，但是 apt 源中自带的 Lazarus 2.0 版本太过陈旧，建议直接从官网<a href="https://www.lazarus-ide.org/index.php?page=downloads" target=_blank rel=noopener>下载</a>最新版。这里下载 64 位版本，包括以下三个安装文件：</p><ul><li><a href=https://sourceforge.net/projects/lazarus/files/Lazarus%20Linux%20amd64%20DEB/Lazarus%203.0/lazarus-project_3.0.0-0_amd64.deb/download target=_blank rel=noopener>lazarus-project_3.0.0-0_amd64.deb</a></li><li><a href=https://sourceforge.net/projects/lazarus/files/Lazarus%20Linux%20amd64%20DEB/Lazarus%203.0/fpc-laz_3.2.2-210709_amd64.deb/download target=_blank rel=noopener>fpc-laz_3.2.2-210709_amd64.deb</a></li><li><a href=https://sourceforge.net/projects/lazarus/files/Lazarus%20Linux%20amd64%20DEB/Lazarus%203.0/fpc-src_3.2.2-210709_amd64.deb/download target=_blank rel=noopener>fpc-src_3.2.2-210709_amd64.deb</a></li></ul><p>在 WSL 终端里执行下面的命令进行安装：</p><pre><span class=code-lang>shell</span><code class=language-shell>sudo apt install ./fpc-laz_3.2.2-210709_amd64.deb
sudo apt install ./fpc-src_3.2.2-210709_amd64.deb
sudo apt install ./lazarus-project_3.0.0-0_amd64.deb</code></pre><p>最新版本的 WSL 通过 Remote Desktop Client 组件（ msrdc.exe ）可以直接显示 WSL 的 GUI 应用，无需任何配置。对于老版本的 WSL ，需要安装一款 XServer （比如 <a href=https://vcxsrv.sourceforge.io target=_blank rel=noopener>VcXSrv</a> 或 <a href=http://www.straightrunning.com/XmingNotes/ target=_blank rel=noopener>Xming</a> ）来显示 GUI 窗口。</p><p>在 WSL 终端里执行下面的命令启动 Lazarus ：</p><pre><span class=code-lang>shell</span><code class=language-shell>lazarus-ide</code></pre><p>也可以使用下面的命令：</p><pre><span class=code-lang>shell</span><code class=language-shell>startlazarus</code></pre><figure><img src=/posts/running-lazarus-ide-in-wsl/lazarus-ide.png alt=lazarus-ide></figure><h2 id=安装--配置中文字体>安装 / 配置中文字体</h2><p>WSL 默认安装的 Ubuntu 没带中文字体，需要安装一款中文字体：</p><pre><span class=code-lang>shell</span><code class=language-shell>sudo apt install fonts-noto-cjk</code></pre><p>或者使用 Windows 的中文字体：</p><pre><span class=code-lang>shell</span><code class=language-shell>sudo apt install fontconfig</code></pre><p>在配置文件 <code>/etc/fonts/local.conf</code> 中写入：</p><pre><span class=code-lang>xml</span><code class=language-xml>&lt;fontconfig&gt;
  &lt;dir&gt;/mnt/c/Windows/Fonts/&lt;/dir&gt;
&lt;/fontconfig&gt;</code></pre><figure><img src=/posts/running-lazarus-ide-in-wsl/lazarus-ide-zh-cn.png alt=lazarus-ide></figure><p>采用共享 Windows 字体时，仍有部分中文显示异常。不过在安装中文字体后，一切显示正常。</p><h2 id=ide-启用-anchor-docking-布局>IDE 启用 Anchor Docking 布局</h2><p>Lazarus 默认安装使用经典的独立小窗口模式。出于使用习惯，可以参考官方文档《<a href=https://wiki.freepascal.org/Anchor_Docking target=_blank rel=noopener>Anchor Docking</a>》将布局合并为单个窗口。在 Lazarus 主菜单中选择「软件包」-「安装/卸载软件包」，在对话框的右侧「可用于安装」列表中选择「 AnchorDockingDsgn 1.0 」进行安装，点击「保存并重新构建IDE」按钮。</p><figure><img src=/posts/running-lazarus-ide-in-wsl/install-uninstall-packages.png alt=install-uninstall-packages></figure><p>之后 Lazarus 会重新编译，并在编译成功后自动重启。</p><h2 id=修复若干问题>修复若干问题</h2><p>不出意外，在安装和配置 Lazarus IDE 的过程中，意外就发生了。</p><h3 id=问题一>问题一</h3><p>WSLg 渲染的「安装/卸载软件包」对话框无法操作，处于不可用状态。查看日志 <em>/mnt/wslg/weston.log</em> 发现如下内容：</p><pre><code class=language-text>[12:34:56.789] Client: ClientGetAppidReq: WindowId:0x53 does not have appId, or not top level window.</code></pre><p>这应该是一个兼容性问题，暂时没有找到 WSLg 下的解决方案。最后使用 MobaXterm 自带的 XServer 临时解决了安装软件包的问题。</p><h3 id=问题二>问题二</h3><p>在重新构建 IDE 的时候，编译器报错：</p><pre><code class=language-text>构建 IDE: 退出代码2,错误: 1
 Makefile(135,0) Error: linker:*** Compiler /usr/bin/fpc.exe not found. Stop.</code></pre><p>很显然，是 Lazarus 的某个 Makefile 文件配置有问题，错误地使用了 Windows 版本的可执行文件扩展名。在一阵翻找后，发现 Lazarus 携带的 Makefile 文件还挺多的，无法定位是哪个 Makefile 文件出的问题。最后只能曲线救国，生成一个 <code>fpc.exe</code> 出来。在 WSL 终端下执行命令：</p><pre><span class=code-lang>shell</span><code class=language-shell>sudo ln -s /usr/bin/fpc /usr/bin/fpc.exe</code></pre><p>在主菜单中选取「工具」-「使用配置文件: 一般的IDE 构建 Lazarus 」，重新构建 Lazarus 。</p><p>经过论坛老哥的指点，发现第二问题是由于 Lazarus 错误地使用了 Windows 环境中的 make 命令来执行编译导致的。虽然我不理解明明 WSL 下 <code>which make</code> 返回的结果是 <code>/usr/bin/make</code> ，可 Lazarus 却还是会使用 Windows 环境中的 make 命令。在 WSL 中使用下面的命令剔除 Windows 的 PATH 环境变量便可以解决问题：</p><pre><span class=code-lang>shell</span><code class=language-shell>export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/snap/bin</code></pre><p>或者在配置文件 <em>/etc/wsl.conf</em> 中禁止 WSL 使用 Windows 的路径：</p><pre><span class=code-lang>ini</span><code class=language-ini>[interop]
appendWindowsPath = false</code></pre><h3 id=问题三>问题三</h3><p>Lzaraus 成功安装后，能在 Windows 开始菜单里找到菜单项「Lazarus (Ubuntu)」。在 Windows 中直接点击就能打开 Linux 版的 Lazarus 了。不过，当我们启用 Anchor Docking 布局并重新编译 Lazarus IDE 后就会发现，通过 Windows 开始菜单项启动 Lazarus IDE 会闪退。这是因为 IDE 重新编译后，会在目录 <em>~/.lazarus/bin</em> 下生成新的 <em>lazarus</em> 可执行文件，使用 <code>startlazarus</code> 启动后会创建新进程 <em>~/.lazarus/bin/lazarus</em> 并退出当前进程，而 WSLg 无法渲染新进程的 GUI。</p><p>解决方法是修改 Windows 菜单的快捷方式目标为：</p><pre><code class=language-text>&#34;C:\Program Files\WSL\wslg.exe&#34; -d Ubuntu --cd &#34;~&#34; -- ~/.lazarus/bin/lazarus</code></pre></div><div class=taxonomy data-pagefind-ignore><div class=taxonomy-tags><ul class=tags><li>#<a data-pagefind-filter=标签 href=/tags/Lazarus/>Lazarus</a></li><li>#<a data-pagefind-filter=标签 href=/tags/WSL/>WSL</a></li></ul></div></div><div class=pagination data-pagefind-ignore><a href=/posts/cross-platform-GUI-framework-HaxeUI-trials/ class="left arrow">上一篇：<br>试用跨平台 GUI 框架 HaxeUI</a>
<a href=/moments/202312/1703735959/ class="right arrow">下一篇</a>
<a href=# class=top>返回顶部</a></div></main><script src=/js/page.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/delphi.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/dos.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/haxe.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-svelte/dist/svelte.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=/js/code.js></script><script>hljs.highlightAll(),hljs.initLineNumbersOnLoad(),hljs.initSelectLines()</script><footer><span>&copy; <time datetime="2024-12-18 02:05:32.636328658 +0000 UTC m=+1.174896130">2024</time> fournoas.com. Powered by <a href=https://gohugo.io>Hugo</a>.</span></footer></body></html>