<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="默认情况下，Free Pascal 类中 protected 成员只能被当前类、子类以及同一个 Unit 中的代码访问。然而在实践中，往往会碰到访问其他 Unit 中定义的类实例对象的 protected 成员的需求。通常我们会通过类继承以及修改原始类成员的代码来暴露 protected 成员，然而当该对象来自第三方库，甚至 FCL 和 LCL 时，情况就会比较棘手。有一种 Hack 方法可以实现这个需求，且不用修改原始 Unit 的代码，没有额外副作用。"><title>Free Pascal Hack 之访问对象的 protected 成员 &#183; 白汤四物</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/regular.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href rel=alternate type=application/rss+xml title=白汤四物><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-3GNL63B62Q"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3GNL63B62Q")</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/search/><span>搜索</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><main data-pagefind-body><div class="page post"><h1 class=post-title data-pagefind-meta=title>Free Pascal Hack 之访问对象的 protected 成员</h1><div class=post-line></div><div class=post-info><span>作者</span>
<span data-pagefind-meta=作者>Fournoas
</span><span>写于&nbsp;</span><time datetime="2025-09-04 00:00:00 +0000 UTC" data-pagefind-meta=日期>2025年9月4日</time>
<span>发布在&nbsp;</span><ul class=categories><li><a data-pagefind-filter=分类 href=/categories/coding/>Coding</a></li></ul></div><p>默认情况下，Free Pascal 类中 protected 成员只能被当前类、子类以及同一个 Unit 中的代码访问。然而在实践中，往往会碰到访问其他 Unit 中定义的类实例对象的 protected 成员的需求。通常我们会通过类继承以及修改原始类成员的代码来暴露 protected 成员，然而当该对象来自第三方库，甚至 FCL 和 LCL 时，情况就会比较棘手。有一种 Hack 方法可以实现这个需求，且不用修改原始 Unit 的代码，没有额外副作用。</p><p>假设在 unit1.pas 中定义了类 <code>TFoo</code>：</p><pre><span class=code-lang>pascal</span><code class=language-pascal>unit Unit1; 

interface

type
  TFoo = class
  protected
    FMember: string;
  end;

var
  Foobar: TFoo;

implementation

type
  TBar = class(TFoo);

initialization 

Foobar := TBar.Create;

finalization

FreeAndNil(Foobar);

end.</code></pre><p>在 unit2.pas 中访问 <code>Foo.FMember</code> 成员：</p><pre><span class=code-lang>pascal</span><code class=language-pascal>unit Unit2; 

interface

uses 
  Unit1;

implementation

type
  TFooAccessProtected = class(TFoo);

function GetFooProtectedMember: string;
begin
  Result := TFooAccessProtected(Foobar).FMember;
end;

end.</code></pre><p>虽然 <code>TFooAccessProtected</code> 和 <code>TBar</code> 两个类型并不在同一条继承链上，但是 <code>TFooAccessProtected</code> 和 <code>TFoo</code> 对象的内存布局是一致的。而在 Unit2 中的代码是可以访问 <code>TFooAccessProtected</code> 及其父类中所有的 protected 成员的。通过强制类型转换，使得 <code>TFoo</code> 的 <code>FMember</code> 暴露在 Unit2 中。</p><p>不过需要注意：在 Debug 模式下，Hack 代码 <code>TFooAccessProtected(Foobar)</code> 运行时会抛出 <code>RunError(219)</code> 以及 <code>EInvalidCast</code> 异常。这是因为 Debug 模式开启了编译指令“验证方法调用 (-CR)”。可以在代码里临时禁用该编译器指令：</p><pre><span class=code-lang>pascal</span><code class=language-pascal>function GetFooProtectedMember: string;
begin
{$IFDEF DEBUG}{$objectChecks-}{$ENDIF}
  Result := TFooAccessProtected(Foobar).FMember;
{$IFDEF DEBUG}{$objectChecks&#43;}{$ENDIF}
end;</code></pre></div><div class=taxonomy data-pagefind-ignore><div class=taxonomy-tags><ul class=tags><li>#<a data-pagefind-filter=标签 href=/tags/Pascal/>Pascal</a></li></ul></div></div><div class=pagination data-pagefind-ignore><a href=/posts/lazarus-project-internationalization-advanced/ class="left arrow">上一篇：<br>Lazarus 项目支持多语言国际化（进阶篇）</a>
<a href=/posts/fixing-a-vcpkg-failure-caused-by-scoop-update/ class="right arrow">下一篇：<br>修复 scoop update 后 vcpkg 无法运行的故障</a>
<a href=# class=top>返回顶部</a></div></main><script src=/js/page.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/delphi.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/dos.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/haxe.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-svelte/dist/svelte.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-zig/dist/zig.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-redbol/dist/redbol.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=/js/code.js></script><script>hljs.highlightAll(),hljs.initLineNumbersOnLoad(),hljs.initSelectLines()</script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js crossorigin=anonymous referrerpolicy=no-referrer onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})</script><footer><span>&copy; <time datetime="2025-09-09 05:03:45.939054426 +0000 UTC m=+0.803415515">2025</time> fournoas.com. Powered by <a href=https://gohugo.io/>Hugo</a> v0.150.0.</span></footer></body></html>