<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="系统使用的 vcpkg 是由 scoop 安装的，在某次 scoop update -a 更新后故障无法运行。通过分析发现是由于安装脚本执行失败导致 scoop shim 指向错误引起的。以下是故障分析过程。
发现问题
打开 UniGetUI 更新时发现 vcpkg 的安装源不见了。
在命令行中运行 vcpkg 提示：
Shim: Could not determine if target is a GUI app. Assuming console.
Shim: Could not create process with command '&#34;D:\Apps\scoop\apps\vcpkg\current\vcpkg.exe&#34; '.
运行命令 scoop list vcpkg，显示软件已安装：
Installed apps matching 'vcpkg':

Name  Version    Source Updated             Info
----  -------    ------ -------             ----
vcpkg 2025.07.25 main   2025-07-29 10:56:05
尝试修复
看起来是 scoop shim 出了问题。尝试用 scoop reset vcpkg 命令重置。再次运行 vcpkg，无响应。接着尝试卸载 vcpkg 重新安装。运行 scoop uninstall vcpkg 命令，卡在运行 uninstall script 无响应。"><title>修复 scoop update 导致的 vcpkg 故障 &#183; 白汤四物</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/regular.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href rel=alternate type=application/rss+xml title=白汤四物><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-3GNL63B62Q"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3GNL63B62Q")</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/search/><span>搜索</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><main data-pagefind-body><div class="page post"><h1 class=post-title data-pagefind-meta=title>修复 scoop update 导致的 vcpkg 故障</h1><div class=post-line></div><div class=post-info><span>作者</span>
<span data-pagefind-meta=作者>Fournoas
</span><span>写于&nbsp;</span><time datetime="2025-08-26 00:00:00 +0000 UTC" data-pagefind-meta=日期>2025年8月26日</time>
<span>发布在&nbsp;</span><ul class=categories><li><a data-pagefind-filter=分类 href=/categories/using/>Using</a></li></ul></div><p>系统使用的 vcpkg 是由 scoop 安装的，在某次 <code>scoop update -a</code> 更新后故障无法运行。通过分析发现是由于安装脚本执行失败导致 scoop shim 指向错误引起的。以下是故障分析过程。</p><h2 id=发现问题>发现问题</h2><p>打开 <a href=https://www.marticliment.com/unigetui/ target=_blank rel=noopener>UniGetUI</a> 更新时发现 vcpkg 的安装源不见了。</p><p>在命令行中运行 <code>vcpkg</code> 提示：</p><pre><code class=language-text>Shim: Could not determine if target is a GUI app. Assuming console.
Shim: Could not create process with command &#39;&#34;D:\Apps\scoop\apps\vcpkg\current\vcpkg.exe&#34; &#39;.</code></pre><p>运行命令 <code>scoop list vcpkg</code>，显示软件已安装：</p><pre><code class=language-text>Installed apps matching &#39;vcpkg&#39;:

Name  Version    Source Updated             Info
----  -------    ------ -------             ----
vcpkg 2025.07.25 main   2025-07-29 10:56:05</code></pre><h2 id=尝试修复>尝试修复</h2><p>看起来是 scoop shim 出了问题。尝试用 <code>scoop reset vcpkg</code> 命令重置。再次运行 <code>vcpkg</code>，无响应。接着尝试卸载 vcpkg 重新安装。运行 <code>scoop uninstall vcpkg</code> 命令，卡在运行 <samp>uninstall script</samp> 无响应。</p><p>查看 <samp>vcpkg.shim</samp> 文件，内容如下：</p><pre><code class=language-text>path = &#34;D:\Apps\scoop\shims\vcpkg.exe&#34;</code></pre><p>scoop shim 竟然指向自己。这导致运行 <code>vcpkg</code> 命令后会不断调用自身，形成死循环。这就是执行 <code>vcpkg</code> 命令无响应的原因。而卸载脚本中调用了 <code>vcpkg integrate remove</code> 命令，导致卸载命令也无响应。</p><p>打开 vcpkg 的安装目录，<strong>发现目录下找不到 <samp>vcpkg.exe</samp> 可执行文件</strong>。这应该就是引起故障的最终原因。</p><p>可以排除软件是被外部破话的，因此怀疑是安装过程中的某些原因导致文件缺失。用 <code>scoop cat vcpkg</code> 查看它的 manifest。发现安装脚本是 <samp>bootstrap-vcpkg.bat</samp>。运行该脚本后发现安装目录下生成了 <samp>vcpkg.exe</samp> 文件。查看安装脚本，发现可执行文件是从 github 下载的：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>if ($env:PROCESSOR_ARCHITECTURE -eq &#39;ARM64&#39; -or $env:PROCESSOR_IDENTIFIER -match &#34;ARMv[8,9] \(64-bit\)&#34;) {
    &amp; &#34;$scriptsDir/tls12-download-arm64.exe&#34; github.com &#34;/microsoft/vcpkg-tool/releases/download/$versionDate/vcpkg-arm64.exe&#34; &#34;$vcpkgRootDir\vcpkg.exe&#34;
} else {
    &amp; &#34;$scriptsDir/tls12-download.exe&#34; github.com &#34;/microsoft/vcpkg-tool/releases/download/$versionDate/vcpkg.exe&#34; &#34;$vcpkgRootDir\vcpkg.exe&#34;
}</code></pre><p>至此问题解决。</p><h2 id=总结>总结</h2><p>Scoop 缺乏一种验证和保障软件安装完整性的机制，一旦软件安装脚本执行过程中发生某些错误或异常引起数据缺失会导致后续各种莫名其妙的问题。</p><p>亦或者说，scoop 将保障安装完整性的责任丢给了安装脚本。但仍然希望 scoop 能提供类似 <code>scoop repair</code> 命令来检查和修复已安装的软件。</p></div><div class=taxonomy data-pagefind-ignore><div class=taxonomy-tags><ul class=tags><li>#<a data-pagefind-filter=标签 href=/tags/Scoop/>Scoop</a></li></ul></div></div><div class=pagination data-pagefind-ignore><a class=left>&nbsp</a>
<a href=/posts/scoop-install-google-chrome-user-data-issue/ class="right arrow">下一篇：<br>Scoop 安装 Chrome 浏览器的用户数据问题</a>
<a href=# class=top>返回顶部</a></div></main><script src=/js/page.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/delphi.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/dos.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/haxe.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-svelte/dist/svelte.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-zig/dist/zig.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-redbol/dist/redbol.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=/js/code.js></script><script>hljs.highlightAll(),hljs.initLineNumbersOnLoad(),hljs.initSelectLines()</script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js crossorigin=anonymous referrerpolicy=no-referrer onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})</script><footer><span>&copy; <time datetime="2025-08-26 04:50:38.02899683 +0000 UTC m=+1.057747879">2025</time> fournoas.com. Powered by <a href=https://gohugo.io/>Hugo</a> v0.148.2.</span></footer></body></html>