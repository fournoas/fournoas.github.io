<!doctype html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="使用 Windows 资源管理器，将 Windows 中的文件复制到 WSL 文件系统中时发现，目标路径下会多出一个 Zone.Identifier 后缀的文件：
foo.txt
foo.txt:Zone.Identifier"><title>Zone.Identifier 文件和 NTFS 数据流 &#183; 白汤四物</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/fontawesome.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/solid.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/regular.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js crossorigin=anonymous></script><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/rainbow.min.css crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css crossorigin=anonymous referrerpolicy=no-referrer><link href rel=alternate type=application/rss+xml title=白汤四物><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-3GNL63B62Q"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3GNL63B62Q")</script></head><body><nav class=nav><div class=nav-container><h1 class=nav-title><a href=/><img src=/logo.png alt=白汤四物></a></h1><ul><li><a href=/posts/><span>文章</span></a></li><li><a href=/moments/><span>动态</span></a></li><li><a href=/categories/><span>分类</span></a></li><li><a href=/tags/><span>标签</span></a></li><li><a href=/search/><span>搜索</span></a></li><li><a href=/about/><span>关于</span></a></li></ul></div></nav><main data-pagefind-body><div class="page post"><h1 class=post-title data-pagefind-meta=title>Zone.Identifier 文件和 NTFS 数据流</h1><div class=post-line></div><div class=post-info><span>作者</span>
<span data-pagefind-meta=作者>Fournoas
</span><span>写于&nbsp;</span><time datetime="2024-12-12 00:00:00 +0000 UTC" data-pagefind-meta=日期>2024年12月12日</time>
<span>发布在&nbsp;</span><ul class=categories><li><a data-pagefind-filter=分类 href=/categories/using/>Using</a></li></ul></div><p>使用 Windows 资源管理器，将 Windows 中的文件复制到 WSL 文件系统中时发现，目标路径下会多出一个 <samp>Zone.Identifier</samp> 后缀的文件：</p><pre><code class=language-text>foo.txt
foo.txt:Zone.Identifier</code></pre><p>之所以会生成这个文件，和 Windows 的一个安全特性有关，这个安全特性利用 NTFS 文件系统的数据流，为文件保存了一些额外的不可见信息。而资源管理器在复制文件时，将文件的数据流也一起复制过去了。这个多出来的 <samp>Zone.Identifier</samp> 后缀文件保存的便是看不见的数据流内容。这个文件对 WSL 系统没什么作用，可以直接删除。不过我们还是可以了解一下这个文件的来龙去脉。</p><h2 id=windows-的安全警告>Windows 的安全警告</h2><p>Windows 有一个安全特性，当用户打开从网络下载的文件时，系统会弹出如下的安全警告消息框：</p><figure><img src=/posts/Zone.Identifier-files-and-NTFS-alternate-data-streams/alert.png alt=安全警告></figure><p>打开文件属性，可以看到 <samp>此文件来自其他计算机，可能被阻止以帮助保护该计算机</samp> 的安全提示：</p><figure><img src=/posts/Zone.Identifier-files-and-NTFS-alternate-data-streams/file-property.png alt=文件属性></figure><details><summary>为什么我的系统没有弹出「安全警告」消息框？</summary><p>该安全特性可以通过「本地组策略编辑器」启用和关闭：</p><ol><li>运行 <code>gpedit.msc</code></li><li>打开 <samp>用户配置</samp> > <samp>管理模板</samp> > <samp>Windows 组件</samp> > <samp>附件管理器</samp><br><img src=/posts/Zone.Identifier-files-and-NTFS-alternate-data-streams/gpedit-1.png alt=本地组策略编辑器></li><li>双击打开 <samp>文件附件默认风险级别</samp>，选中 <samp>已启用</samp>，并设置默认风险等级为 <samp>高风险</samp><br><img src=/posts/Zone.Identifier-files-and-NTFS-alternate-data-streams/gpedit-2.png alt=文件附件默认风险级别></li></ol></details><p>那系统又是如何知道这个文件来自其他计算的呢？原来，当浏览器从互联网上下载文件后，还会将文件来源的数据写入下载文件的「<strong>NTFS 数据流</strong>」中。</p><h2 id=ntfs-数据流>NTFS 数据流</h2><p>NTFS 数据流的正式名称为 <em>Alternate Data Streams</em>，缩写是 <abbr title="Alternative Data Streams">ADS</abbr> ，中文可以翻译成「备用数据流」。这是 NTFS 文件系统的一个特性，它允许在文件的内容之外保存额外的数据，每个文件可以存在多个数据流文件。简单地说，就是在 NTFS 文件系统中，每个文件名可以对应不止一份内容。虽然在资源管理器中用户只能看到默认的文件内容，但是可以通过一些方法和工具来访问不可见的数据流文件。</p><h3 id=写入数据流内容>写入数据流内容</h3><p>Windows 用冒号 <code>:</code> 来分隔文件名和数据流文件名。简单使用 <code>echo</code> 命令便可以实现写入：</p><pre><span class=code-lang>cmd</span><code class=language-cmd>echo &#34;Test Text&#34;&gt;D:\test.txt:TestStream</code></pre><p>或使用 PowerShell 命令：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>set-content -Path D:\test.txt -Stream TestStream -Value &#34;Test Text&#34;</code></pre><p>其中 <code>D:\test.txt</code> 是要写入数据流的文件名，而 <code>TestStream</code> 则是数据流的名称，<code>Test Text</code> 则是写入的数据流内容。</p><div class=note><div class=note-header><span class=note-title>注意</span></div><div class=note-content>此处 D 盘必须使用 NTFS 文件系统。</div></div><h3 id=查看数据流内容>查看数据流内容</h3><p>使用如下命令查看数据流内容：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>get-content -Path D:\test.txt -Stream TestStream</code></pre><p>也可以直接用记事本等应用打开数据流：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>notepad D:\test.txt:TestStream</code></pre><h3 id=找出文件的数据流>找出文件的数据流</h3><p>使用 <a href=https://learn.microsoft.com/en-us/sysinternals/ target=_blank rel=noopener>Sysinternals</a> 的命令行工具 <a href=https://learn.microsoft.com/en-us/sysinternals/downloads/streams target=_blank rel=noopener>Streams</a> 可以找出和删除文件的数据流。使用方法如下：</p><pre><code class=language-text>usage: streams.exe [-s] [-d] &lt;file or directory&gt;
-s     Recurse subdirectories
-d     Delete streams
-nobanner
       Do not display the startup banner and copyright message.</code></pre><p>使用以下命令查看文件的数据流：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>streams D:\test.txt</code></pre><p>还可以递归查找文件夹以及子文件夹内文件的数据流：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>streams -s D:\</code></pre><div class=note><div class=note-header><span class=note-title>顺便一提</span></div><div class=note-content><p>文件夹也是可以存在数据流文件的。</p></div></div><p>也可以用 PowerShell 命令：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>get-item -Path D:\test.txt -Stream *</code></pre><p>在命令行提示符下使用 <code>dir /r</code> 命令可以列出目录下所有文件及其数据流。</p><h3 id=删除文件的数据流>删除文件的数据流</h3><p>使用 <code>streams</code> 命令删除文件的全部数据流：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>streams -d D:\foo.pdf</code></pre><p>或使用 PowerShell 命令删除文件所有数据流：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>remove-item -Path D:\foo.pdf -Stream *</code></pre><p>也可以删除指定的数据流：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>remove-item -Path D:\foo.pdf -Stream Zone.Identifier</code></pre><p>以及清空数据流内容：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>clear-content -Path D:\foo.pdf -Stream Zone.Identifier</code></pre><h2 id=zoneidentifier-和-smartscreen-数据流>Zone.Identifier 和 SmartScreen 数据流</h2><p>用 <code>streams</code> 命令查看 <samp>D:\foo.pdf</samp> 文件包含的数据流：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>get-item -Path D:\foo.pdf -Stream *</code></pre><p>返回结果：</p><pre><code class=language-text>PSPath        : Microsoft.PowerShell.Core\FileSystem::D:\foo.pdf::$DATA
PSParentPath  : Microsoft.PowerShell.Core\FileSystem::D:\
PSChildName   : foo.pdf::$DATA
PSDrive       : D
PSProvider    : Microsoft.PowerShell.Core\FileSystem
PSIsContainer : False
FileName      : D:\foo.pdf
Stream        : :$DATA
Length        : 36158778

PSPath        : Microsoft.PowerShell.Core\FileSystem::D:\foo.pdf:Zone.Identifier
PSParentPath  : Microsoft.PowerShell.Core\FileSystem::D:\
PSChildName   : foo.pdf:Zone.Identifier
PSDrive       : D
PSProvider    : Microsoft.PowerShell.Core\FileSystem
PSIsContainer : False
FileName      : D:\foo.pdf
Stream        : Zone.Identifier
Length        : 223</code></pre><p>这个 <samp>Zone.Identifier</samp> 数据流中保存的就是文件的来源。使用下列命令查看该数据流的内容：</p><pre><span class=code-lang>powershell</span><code class=language-powershell>get-content -Path D:\foo.pdf -Stream Zone.Identifier</code></pre><p>内容如下：</p><pre><code class=language-text>[ZoneTransfer]
ZoneId=3
ReferrerUrl=https://github.com/tabris17/traymond/releases
HostUrl=https://objects.githubusercontent.com/... ...</code></pre><p>其中 <code>ZoneId</code> 表示文件来源，它可以是以下的值：</p><ul><li><code>0</code> 本机</li><li><code>1</code> 局域网</li><li><code>2</code> 可信的</li><li><code>3</code> 互联网</li><li><code>4</code> 不可信的</li></ul><p>对于某些下载文件，还会多出一个名为 <samp>SmartScreen</samp> 的数据流。比如这个 <samp>foo.exe</samp> 文件：</p><pre><span class=code-lang>txt</span><code class=language-txt>PSPath        : Microsoft.PowerShell.Core\FileSystem::D:\foo.exe::$DATA
PSParentPath  : Microsoft.PowerShell.Core\FileSystem::D:\
PSChildName   : foo.exe::$DATA
PSDrive       : D
PSProvider    : Microsoft.PowerShell.Core\FileSystem
PSIsContainer : False
FileName      : D:\foo.exe
Stream        : :$DATA
Length        : 124120680

PSPath        : Microsoft.PowerShell.Core\FileSystem::D:\foo.exe:SmartScreen
PSParentPath  : Microsoft.PowerShell.Core\FileSystem::D:\
PSChildName   : foo.exe:SmartScreen
PSDrive       : D
PSProvider    : Microsoft.PowerShell.Core\FileSystem
PSIsContainer : False
FileName      : D:\foo.exe
Stream        : SmartScreen
Length        : 7

PSPath        : Microsoft.PowerShell.Core\FileSystem::D:\foo.exe:Zone.Identifier
PSParentPath  : Microsoft.PowerShell.Core\FileSystem::D:\
PSChildName   : foo.exe:Zone.Identifier
PSDrive       : D
PSProvider    : Microsoft.PowerShell.Core\FileSystem
PSIsContainer : False
FileName      : D:\foo.exe
Stream        : Zone.Identifier
Length        : 156</code></pre><p><samp>D:\foo.exe:SmartScreen</samp> 文件内容如下：</p><pre><code class=language-text>Anaheim</code></pre><p>如果一个可执行文件包含此数据流，Windows 会弹出如下的警告对话框：</p><figure><img src=/posts/Zone.Identifier-files-and-NTFS-alternate-data-streams/smartscreen.png alt=SmartSreen></figure><h2 id=exploit>Exploit</h2><p>在早年 Windows XP 时代，NTFS 刚在用户电脑中普及，有些病毒和木马程序会寄生在文件的数据流中。不过现在的杀毒软件都能查杀此类病毒。另外，专业的取证软件也不会落下数据流中隐藏的信息，利用 NTFS 数据流来隐藏个人数据没有任何安全性可言。</p><h2 id=参考资料>参考资料</h2><ol><li><a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/6e3f7352-d11c-4d76-8c39-2516a9df36e8 target=_blank rel=noopener>MS-FSCC: Zone.Identifier Stream Name</a></li><li><a href="https://learn.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms537183%28v=vs.85%29" target=_blank rel=noopener>About URL Security Zones</a></li></ol></div><div class=taxonomy data-pagefind-ignore><div class=taxonomy-tags><ul class=tags><li>#<a data-pagefind-filter=标签 href=/tags/Windows/>Windows</a></li></ul></div></div><div class=pagination data-pagefind-ignore><a href=/moments/202412/1735265060/ class="left arrow">上一篇</a>
<a href=/posts/a-lightweight-IDE-lite-xl/ class="right arrow">下一篇：<br>轻量级 IDE：Lite XL</a>
<a href=# class=top>返回顶部</a></div></main><script src=/js/page.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/scala.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nim.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/powershell.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/nginx.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/delphi.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/dos.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/haxe.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-svelte/dist/svelte.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-zig/dist/zig.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://unpkg.com/highlightjs-redbol/dist/redbol.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=/js/code.js></script><script>hljs.highlightAll(),hljs.initLineNumbersOnLoad(),hljs.initSelectLines()</script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js crossorigin=anonymous referrerpolicy=no-referrer onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})</script><footer><span>&copy; <time datetime="2025-10-31 03:11:53.223929996 +0000 UTC m=+0.897439834">2025</time> fournoas.com. Powered by <a href=https://gohugo.io/>Hugo</a> v0.152.2.</span></footer></body></html>